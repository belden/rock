#!/usr/bin/env bash

path="${1:$( pwd )}"
deps_path="${path}/requirements.txt"
virtualenv_path="${path}/vendor/virtualenv"

if [[ ! -f "$deps_path" ]]; then
  echo "File not found: ${deps_path}" >&2
  exit 1
fi

if ! cd "$path"; then
  exit 1
fi

if [[ ! -f "${virtualenv_path}/bin/activate" ]]; then
  if ! virtualenv "$virtualenv_path" >&2; then
    exit 1
  fi
fi

if ! (. "${virtualenv_path}/bin/activate" && pip install -r "$deps_path") >&2; then
  exit 1
fi
